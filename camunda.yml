---
- hosts: servers
  become: yes

  tasks:
    - name: Install prerequisites
      apt:
        name: 
          - openjdk-8-jdk
          - unzip
        state: present
      tags: 
        - prerequisites

    - name: Add Camunda user
      user:
        name: inferyx
        shell: /bin/bash
        createhome: yes
      tags:
        - users

    - name: Download Camunda distribution
      get_url:
        url: https://camunda.org/release/camunda-bpm/tomcat/7.15/camunda-bpm-tomcat-7.15.0.tar.gz
        dest: /tmp/camunda.tar.gz
      tags:
        - download

    - name: Extract Camunda distribution
      unarchive:
        src: /tmp/camunda.tar.gz
        dest: /opt
        remote_src: yes
      tags:
        - extract

    - name: Set up Camunda as a service
      template:
        src: /path/to/camunda.service.j2  # Specify the path to your template file if you have one
        dest: /etc/systemd/system/camunda.service
        owner: root
        group: root
        mode: 0644
        backup: yes
        validate: 'systemctl --no-ask-password daemon-reload && systemctl status --no-pager camunda'
      tags:
        - service

    - name: Start Camunda service
      systemd:
        name: camunda
        state: started
      tags:
        - service
