- name: Copy files to destination
  hosts: servers
  connection: local
  tasks:
    - name: copy src.txt as dest.txt in the same dir 
      copy:
        src: files/src.txt
        dest: files/dest.txt
      tags:
        - simple_copy

- name: Copy and extract inferyx platform tar file
  hosts: servers
  become: yes
  tasks:
    - name: Create necessary directories
      file:
        path: "{{ item }}"
        state: directory
        mode: '0755'
      loop:
        - /app/
        - /backup/
        - /install/
        - /install/framework/
        - /install/framework/build/

    - name: Verify directories
      command: ls -ld /app/ /backup/ /install/ /install/framework/ /install/framework/build/
      register: dir_listing

    - name: Print directory listings
      debug:
        msg: "{{ dir_listing.stdout_lines }}"

    - name: Copy inferyx-platform-test-v6.1.3.tar.gz to /install/framework/build/ directory on remote server
      ansible.builtin.copy:
        src: /home/ubuntu/
        dest: /install/framework/build/inferyx-platform-test-v6.1.3.tar.gz
        mode: '0644'

    - name: Extract inferyx platform tar file
      ansible.builtin.command: tar xzf /install/framework/build/inferyx-platform-test-v6.1.3.tar.gz -C /install/framework/build/

    - name: Verify extracted files
      command: ls -l /install/framework/build/
      register: extracted_files_listing

    - name: Print extracted files listing
      debug:
        msg: "{{ extracted_files_listing.stdout_lines }}"
